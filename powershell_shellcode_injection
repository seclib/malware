
rule powershell_shellcode_injection
{
    meta:
        hash="57792f5322d9bc66dab9b9a6ca38af43114994b81046352fab03d1af775a4531"
    strings:
        $s1 = "powershell "

        //$enc1 = "VirtualAlloc" base64
        $enc1 = /(AGkAcgB0AHUAYQBsAEEAbABsAG8AYw|aXJ0dWFsQWxsb2|VgBpAHIAdAB1AGEAbABBAGwAbABvAGMA|VmlydHVhbEFsbG9j|YAaQByAHQAdQBhAGwAQQBsAGwAbwBjA|ZpcnR1YWxBbGxvY)/

        //$enc2 = "CreateThread" base64
        $enc2 = /(AHIAZQBhAHQAZQBUAGgAcgBlAGEAZA|cmVhdGVUaHJlYW|MAcgBlAGEAdABlAFQAaAByAGUAYQBkA|NyZWF0ZVRocmVhZ|Q3JlYXRlVGhyZWFk|QwByAGUAYQB0AGUAVABoAHIAZQBhAGQA)/

    condition:
        filesize < 10KB
        and $s1 at 0
        and all of ($enc*)
}
